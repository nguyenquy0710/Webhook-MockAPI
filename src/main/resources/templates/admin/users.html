<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: head('User Management')">
    <title>User Management</title>
</head>
<body>
<div th:replace="fragments/header :: header"></div>
<div class="container">
    <div th:replace="fragments/navigation :: navigation"></div>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Users</h2>
        <a th:href="@{/admin/users/create}" class="btn btn-primary">
            <i class="fas fa-user-plus me-1"></i> Create User
        </a>
    </div>

    <!-- Success Message -->
    <div class="alert alert-success alert-dismissible fade show" role="alert" th:if="${successMessage}">
        <span th:text="${successMessage}">Success message</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <!-- Error Message -->
    <div class="alert alert-danger alert-dismissible fade show" role="alert" th:if="${errorMessage}">
        <span th:text="${errorMessage}">Error message</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <!-- Legacy success message for backward compatibility -->
    <div class="alert alert-success alert-dismissible fade show" role="alert" th:if="${param.deleted}">
        User deleted successfully!
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Username</th>
                <th>Email</th>
                <th>Role</th>
                <th>Status</th>
                <th>Created</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="u : ${users}">
                <td th:text="${u.id}">1</td>
                <td th:text="${u.username}">user</td>
                <td th:text="${u.email}">email</td>
                <td>
                    <span class="badge" th:classappend="${u.role == 'ADMIN' ? 'bg-danger' : 'bg-secondary'}" 
                          th:text="${u.role}">USER</span>
                </td>
                <td>
                    <span class="badge" th:classappend="${u.enabled ? 'bg-success' : 'bg-warning'}" 
                          th:text="${u.enabled ? 'Enabled' : 'Disabled'}">Enabled</span>
                </td>
                <td th:text="${#temporals.format(u.createdAt, 'yyyy-MM-dd HH:mm')}">2023-01-01 00:00</td>
                <td>
                    <div class="btn-group" role="group">
                        <!-- View Button -->
                        <a th:href="@{|/admin/users/${u.id}|}" class="btn btn-sm btn-outline-primary" title="View Details">
                            <i class="fas fa-eye"></i>
                        </a>
                        
                        <!-- Toggle Role Button -->
                        <form th:action="@{|/admin/users/${u.id}/toggle-role|}" method="post" class="d-inline">
                            <button class="btn btn-sm btn-outline-info" type="submit" 
                                    th:title="${u.role == 'ADMIN' ? 'Demote to User' : 'Promote to Admin'}"
                                    onclick="return confirm(this.title + '?')">
                                <i class="fas" th:classappend="${u.role == 'ADMIN' ? 'fa-user-minus' : 'fa-user-shield'}"></i>
                            </button>
                        </form>
                        
                        <!-- Toggle Status Button -->
                        <form th:action="@{|/admin/users/${u.id}/toggle-status|}" method="post" class="d-inline">
                            <button class="btn btn-sm" 
                                    th:classappend="${u.enabled ? 'btn-outline-warning' : 'btn-outline-success'}"
                                    type="submit" 
                                    th:title="${u.enabled ? 'Disable User' : 'Enable User'}"
                                    onclick="return confirm(this.title + '?')">
                                <i class="fas" th:classappend="${u.enabled ? 'fa-user-slash' : 'fa-user-check'}"></i>
                            </button>
                        </form>
                        
                        <!-- Delete Button -->
                        <form th:action="@{|/admin/users/${u.id}/delete|}" method="post" class="d-inline">
                            <button class="btn btn-sm btn-outline-danger" type="submit" 
                                    onclick="return confirm('Delete user?')" title="Delete User">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div th:if="${#lists.isEmpty(users)}" class="text-center mt-5">
        <div class="text-muted">
            <i class="fas fa-users fa-3x mb-3"></i>
            <p>No users found.</p>
        </div>
    </div>
</div>
<div th:replace="fragments/footer :: footer"></div>
</body>
</html>

